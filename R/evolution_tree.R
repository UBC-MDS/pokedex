#' Evolution Tree
#'
#' Get the evolution tree of a pokemon character in a data frame
#' Note: this version only creates evolution trees for babies
#'
#' @param name_val
#'
#' @importFrom magrittr '%>%'
#' @import httr
#' @import dplyr
#' @return
#'
#' @examples
#'
#' @export
evolution_tree <- function(name_val){
  ## make sure the pokemon exists in the evolution chain api
  tryCatch({
    exists <- pokedex::pokemon_exists(tolower(name_val))
    if(!exists){
      stop("Error: Pokemon does not exist. Please reference documentation for pokemon that exist in this API.")
    }
  })

  ## get the id value from the stored evolution chain ids
  tryCatch({
    data("evolution_chain")
    evolution_chain_ids$name <- as.character(evolution_chain_ids$name)
    id_val <- evolution_chain_ids %>% filter(name == name_val) %>% .$id
  })

  ## call the evolution api for that id
  url <- paste("http://pokeapi.co/api/v2/evolution-chain/", id_val, sep="")
  r <- httr::GET(url)
  r2 <- httr::content(r)

  ## get the levels for the first and second evolutions
  first <- r2$chain$evolves_to[[1]]
  second <- r2$chain$evolves_to[[1]]$evolves_to[[1]]

  ## prepare to store in data frame
  ## df will have names, trigger and level of trigger columns
  names <- c(first$species$name, second$species$name)
  trigger <- c(first$evolution_details[[1]]$trigger$name, second$evolution_details[[1]]$trigger$name)
  trigger_level <- c(first$evolution_details[[1]]$min_level, second$evolution_details[[1]]$min_level)

  df <- data.frame(name = names, trigger = trigger, level = trigger_level)
  return(df)
}
